{
  "openapi": "3.0.0",
  "info": {
    "title": "API Système de Réservation",
    "version": "1.0.0",
    "description": "API REST pour la gestion des réservations de salles avec contrôle RBAC et audit",
    "contact": {
      "name": "Équipe Développement",
      "email": "dev@company.com"
    },
    "license": {
      "name": "MIT",
      "url": "https://opensource.org/licenses/MIT"
    }
  },
  "servers": [
    {
      "url": "http://localhost:3000",
      "description": "Serveur de développement"
    },
    {
      "url": "https://api-reservation.company.com",
      "description": "Serveur de production"
    }
  ],
  "components": {
    "securitySchemes": {
      "bearerAuth": {
        "type": "http",
        "scheme": "bearer",
        "bearerFormat": "JWT",
        "description": "Token JWT requis pour l'authentification"
      }
    },
    "schemas": {
      "Reservation": {
        "type": "object",
        "properties": {
          "id": {
            "type": "integer",
            "description": "Identifiant unique de la réservation"
          },
          "user_id": {
            "type": "integer",
            "description": "ID de l'utilisateur ayant créé la réservation"
          },
          "room_id": {
            "type": "integer",
            "description": "ID de la salle réservée"
          },
          "date": {
            "type": "string",
            "format": "date",
            "description": "Date de la réservation (YYYY-MM-DD)"
          },
          "heure_debut": {
            "type": "string",
            "format": "time",
            "description": "Heure de début (HH:MM)"
          },
          "heure_fin": {
            "type": "string",
            "format": "time",
            "description": "Heure de fin (HH:MM)"
          },
          "statut": {
            "type": "string",
            "enum": ["validée", "en_attente", "annulée"],
            "description": "Statut de la réservation"
          },
          "equipements_attribues": {
            "type": "array",
            "items": {
              "type": "string"
            },
            "description": "Liste des équipements attribués"
          },
          "responsable_id": {
            "type": "integer",
            "description": "ID du responsable assigné (optionnel)"
          },
          "created_at": {
            "type": "string",
            "format": "date-time",
            "description": "Date de création"
          },
          "updated_at": {
            "type": "string",
            "format": "date-time",
            "description": "Date de dernière modification"
          }
        },
        "required": ["user_id", "room_id", "date", "heure_debut", "heure_fin"]
      },
      "User": {
        "type": "object",
        "properties": {
          "id": {
            "type": "integer"
          },
          "nom": {
            "type": "string"
          },
          "email": {
            "type": "string",
            "format": "email"
          },
          "role": {
            "type": "string",
            "enum": ["admin", "responsable_salle", "chef_service", "utilisateur"]
          }
        }
      },
      "Room": {
        "type": "object",
        "properties": {
          "id": {
            "type": "integer"
          },
          "nom": {
            "type": "string"
          },
          "capacite": {
            "type": "integer"
          }
        }
      },
      "ErrorResponse": {
        "type": "object",
        "properties": {
          "error": {
            "type": "string",
            "description": "Message d'erreur"
          },
          "code": {
            "type": "string",
            "description": "Code d'erreur"
          },
          "details": {
            "type": "object",
            "description": "Détails supplémentaires de l'erreur"
          }
        }
      },
      "AuditLog": {
        "type": "object",
        "properties": {
          "id": {
            "type": "integer"
          },
          "action": {
            "type": "string",
            "description": "Action effectuée"
          },
          "resource_type": {
            "type": "string",
            "description": "Type de ressource affectée"
          },
          "resource_id": {
            "type": "integer",
            "description": "ID de la ressource"
          },
          "user_id": {
            "type": "integer",
            "description": "ID de l'utilisateur ayant effectué l'action"
          },
          "snapshot_before": {
            "type": "object",
            "description": "État avant modification"
          },
          "snapshot_after": {
            "type": "object",
            "description": "État après modification"
          },
          "ip_address": {
            "type": "string",
            "description": "Adresse IP de l'utilisateur"
          },
          "user_agent": {
            "type": "string",
            "description": "User agent du navigateur"
          },
          "timestamp": {
            "type": "string",
            "format": "date-time"
          }
        }
      }
    },
    "parameters": {
      "ReservationId": {
        "name": "id",
        "in": "path",
        "required": true,
        "schema": {
          "type": "integer"
        },
        "description": "ID unique de la réservation"
      },
      "DateFilter": {
        "name": "date",
        "in": "query",
        "schema": {
          "type": "string",
          "format": "date"
        },
        "description": "Filtrer par date (YYYY-MM-DD)"
      },
      "StatutFilter": {
        "name": "statut",
        "in": "query",
        "schema": {
          "type": "string",
          "enum": ["validée", "en_attente", "annulée"]
        },
        "description": "Filtrer par statut"
      },
      "RoomIdFilter": {
        "name": "room_id",
        "in": "query",
        "schema": {
          "type": "integer"
        },
        "description": "Filtrer par ID de salle"
      }
    },
    "responses": {
      "UnauthorizedError": {
        "description": "Token d'authentification manquant ou invalide",
        "content": {
          "application/json": {
            "schema": {
              "$ref": "#/components/schemas/ErrorResponse"
            },
            "example": {
              "error": "Token d'authentification requis",
              "code": "UNAUTHORIZED"
            }
          }
        }
      },
      "ForbiddenError": {
        "description": "Permissions insuffisantes pour cette action",
        "content": {
          "application/json": {
            "schema": {
              "$ref": "#/components/schemas/ErrorResponse"
            },
            "example": {
              "error": "Permissions insuffisantes",
              "code": "FORBIDDEN",
              "details": {
                "required_role": "admin",
                "user_role": "utilisateur"
              }
            }
          }
        }
      },
      "NotFoundError": {
        "description": "Ressource introuvable",
        "content": {
          "application/json": {
            "schema": {
              "$ref": "#/components/schemas/ErrorResponse"
            },
            "example": {
              "error": "Réservation introuvable",
              "code": "NOT_FOUND"
            }
          }
        }
      },
      "ValidationError": {
        "description": "Erreur de validation des données",
        "content": {
          "application/json": {
            "schema": {
              "$ref": "#/components/schemas/ErrorResponse"
            },
            "example": {
              "error": "Données invalides",
              "code": "VALIDATION_ERROR",
              "details": {
                "field": "heure_debut",
                "message": "L'heure de début doit être antérieure à l'heure de fin"
              }
            }
          }
        }
      },
      "ConflictError": {
        "description": "Conflit avec l'état actuel de la ressource",
        "content": {
          "application/json": {
            "schema": {
              "$ref": "#/components/schemas/ErrorResponse"
            },
            "example": {
              "error": "La salle est déjà réservée à ce créneau",
              "code": "CONFLICT"
            }
          }
        }
      }
    }
  },
  "security": [
    {
      "bearerAuth": []
    }
  ],
  "tags": [
    {
      "name": "Reservations",
      "description": "Gestion des réservations de salles"
    },
    {
      "name": "Audit",
      "description": "Logs d'audit et traçabilité"
    },
    {
      "name": "Statistics",
      "description": "Statistiques et rapports d'occupation"
    }
  ],
  "x-rbac-roles": {
    "admin": {
      "description": "Administrateur système - Accès complet",
      "permissions": ["*"]
    },
    "responsable_salle": {
      "description": "Responsable de salle - Gestion des réservations",
      "permissions": [
        "VIEW_RESERVATIONS",
        "UPDATE_RESERVATION",
        "VALIDATE_RESERVATION",
        "CREATE_RESERVATION"
      ]
    },
    "chef_service": {
      "description": "Chef de service - Validation et supervision",
      "permissions": [
        "VIEW_RESERVATIONS",
        "UPDATE_RESERVATION",
        "VALIDATE_RESERVATION",
        "CREATE_RESERVATION",
        "VIEW_STATISTICS"
      ]
    },
    "utilisateur": {
      "description": "Utilisateur standard - Création de réservations",
      "permissions": [
        "CREATE_RESERVATION",
        "VIEW_OWN_RESERVATIONS"
      ]
    }
  },
  "x-audit-config": {
    "enabled": true,
    "retention_days": 365,
    "critical_retention_days": 2555,
    "log_format": "JSON",
    "encryption": true,
    "real_time_monitoring": true,
    "compliance_standards": ["SOX", "GDPR", "PCI"],
    "sensitive_fields": [
      "user_id",
      "email",
      "ip_address"
    ],
    "audit_levels": {
      "CREATE": "INFO",
      "UPDATE": "INFO",
      "DELETE": "CRITICAL",
      "VALIDATE": "INFO",
      "ASSIGN": "INFO"
    }
  }
}