services:
  app:
    build:
      target: development
    environment:
      - NODE_ENV=development
      - LOG_LEVEL=debug
      - CORS_ORIGIN=http://localhost:3000
    volumes:
      - .:/app
      - /app/node_modules
    ports:
      - '3000:3000'
      - '9229:9229'
    command: npm run dev
    healthcheck:
      interval: 60s
      timeout: 15s
      retries: 2
  redis:
    command: redis-server --loglevel verbose --appendonly yes
    ports:
      - '6380:6379'
  adminer:
    profiles: []
    environment:
      - ADMINER_DESIGN=pepa-linha
      - ADMINER_DEFAULT_DB_DRIVER=mysql
      - ADMINER_DEFAULT_DB_HOST=reservation-mysql
      - ADMINER_DEFAULT_DB_NAME=reservation_db
  redis-commander:
    image: rediscommander/redis-commander:latest
    container_name: reservation-redis-commander
    restart: unless-stopped
    environment:
      - REDIS_HOSTS=local:redis:6379
      - REDIS_PASSWORD_FILE=/run/secrets/redis_password
    secrets:
      - redis_password
    ports:
      - '8081:8081'
    depends_on:
      - redis
    networks:
      - reservation-network
    profiles: []
volumes:
  mysql_data:
    driver: local
    driver_opts:
      type: none
      o: bind
      device: ./data/mysql
  redis_data:
    driver: local
    driver_opts:
      type: none
      o: bind
      device: ./data/redis
